generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum RoleName {
  ADMIN
  TECHNICIAN
  USER
}

enum AccessLevel {
  NONE
  READ
  WRITE
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum Criticality {
  LOW
  MEDIUM
  HIGH
}

enum Condition {
  GOOD
  FAIR
  POOR
}

enum MainUse {
  RESIDENTIAL
  COMMERCIAL
  CULTURAL
  OFFICE
  RECREATIONAL
  WAREHOUSE
  EDUCATIONAL
}

enum ServiceStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum Category {
  APARTMENT
  HOUSE
  OFFICE
  SHOP
  GARAGE
  OTHER
}

enum SiteType {
  BUILDING
  COMPLEX
  FLOOR
  UNIT
  ROOM
}

enum RoomUse {
  OFFICE
  DEPOT
  CANTEEN
  CELLAR
  TOILET
  MEETING_ROOM
  TECHNICAL_ROOM
  LABORATORY
}

enum Availability {
  IN_USE
  VACANT
  UNDER_CONSTRUCTION
  RENT
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String
  firstName     String
  lastName      String
  status        UserStatus     @default(ACTIVE)
  roleId        String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  refreshTokens RefreshToken[]
  role          Role           @relation(fields: [roleId], references: [id])

  passwordResetToken String?
  passwordExpiresAt  DateTime?
  passwordResetAt    DateTime?

  @@index([email])
  @@index([roleId])
  @@map("users")
}

enum AssetCategoryType {
  DEVICES
  FINISHINGS
  ITEMS
  MACHINERIES
}

model Role {
  id          String       @id @default(uuid())
  name        RoleName     @unique
  description String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  permissions Permission[]
  users       User[]

  @@index([name])
  @@map("roles")
}

model Permission {
  id          String      @id @default(uuid())
  roleId      String
  resource    String
  accessLevel AccessLevel @default(NONE)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  role        Role        @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, resource])
  @@index([roleId])
  @@map("permissions")
}

model Complex {
  id               String          @id @default(uuid())
  code             String          @unique
  name             String
  availability     Availability    @default(IN_USE)
  status           ServiceStatus   @default(ACTIVE)
  calenderEntityId String?
  calenderEntity   CalenderEntity? @relation(fields: [calenderEntityId], references: [id], onDelete: Cascade)

  // Location
  address String?
  city    String?
  zipCode String?

  // Maintenance Date
  condition   Condition   @default(GOOD)
  criticality Criticality @default(LOW)

  // Dimensions Data
  totalBuildings    Int?
  totalFloors       Int?
  totalUnits        Int?
  totalRooms        Int?
  glazedArea        Float?
  cleanableArea     Float?
  coveredArea       Float?
  totalNetArea      Float?
  totalGrossArea    Float?
  totalHeatedVolume Float?
  totalVolume       Float?

  // Relations
  buildings Building[]
  photos    File[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  floors    Floor[]
  units     Unit[]
  rooms     Room[]

  @@map("complexes")
}

model Building {
  id   String @id @default(uuid())
  name String
  code String

  mainUse      MainUse       @default(RESIDENTIAL)
  availability Availability  @default(IN_USE)
  status       ServiceStatus @default(ACTIVE)

  // Location
  address   String?
  latitude  Float?
  longitude Float?
  city      String?
  zipCode   String?

  // Maintenance Data
  condition   Condition   @default(GOOD)
  criticality Criticality @default(LOW)

  // Dimensional Date
  totalFloors       Int?
  totalUnits        Int?
  totalRooms        Int?
  glazedArea        Float?
  cleanableArea     Float?
  coveredArea       Float?
  totalNetArea      Float?
  totalGrossArea    Float?
  totalHeatedVolume Float?
  totalVolume       Float?

  complexId String
  complex   Complex @relation(fields: [complexId], references: [id], onDelete: Cascade)

  calenderEntityId String?
  calenderEntity   CalenderEntity? @relation(fields: [calenderEntityId], references: [id], onDelete: Cascade)

  photos File[]
  floors Floor[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  units     Unit[]
  rooms     Room[]

  @@unique([complexId, code])
  @@map("buildings")
}

model Floor {
  id     String        @id @default(uuid())
  code   String
  name   String
  level  Int
  status ServiceStatus @default(ACTIVE)

  condition   Condition   @default(GOOD)
  criticality Criticality @default(LOW)

  // Location Data
  complexId  String
  complex    Complex  @relation(fields: [complexId], references: [id])
  buildingId String
  building   Building @relation(fields: [buildingId], references: [id])

  // Dimensions Data
  totalUnits        Int?
  totalRooms        Int?
  glazedArea        Float?
  cleanableArea     Float?
  coveredArea       Float?
  totalNetArea      Float?
  totalGrossArea    Float?
  totalHeatedVolume Float?
  totalVolume       Float?

  rooms Room[]
  units Unit[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([buildingId, code])
  @@map("floors")
}

model Unit {
  id           String        @id @default(uuid())
  code         String
  name         String
  availability Availability  @default(IN_USE)
  status       ServiceStatus @default(ACTIVE)

  calenderEntityId String?
  calenderEntity   CalenderEntity? @relation(fields: [calenderEntityId], references: [id], onDelete: Cascade)

  // Address
  complexId  String?
  complex    Complex?  @relation(fields: [complexId], references: [id])
  buildingId String?
  building   Building? @relation(fields: [buildingId], references: [id])
  floorId    String
  floor      Floor     @relation(fields: [floorId], references: [id], onDelete: Cascade)

  address String?
  city    String?
  zipCode String?

  // Maintenance Data
  totalRooms        Int?
  glazedArea        Float?
  cleanableArea     Float?
  coveredArea       Float?
  totalNetArea      Float?
  totalGrossArea    Float?
  totalHeatedVolume Float?
  totalVolume       Float?

  // Cadastral Data
  cadastralArea           Float?
  urbanSection            String?
  sheet                   String?
  plot                    String?
  subordinate             String?
  class                   Int?
  size                    Float?
  propertyRightsAndDuties String?
  cadastralIncome         Decimal?
  censusArea              String?
  subArea                 String?

  rooms  Room[]
  photos File[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([floorId, code])
  @@map("units")
}

model Room {
  id     String        @id @default(uuid())
  name   String
  code   String
  use    RoomUse       @default(OFFICE)
  status ServiceStatus @default(ACTIVE)

  calenderEntityId String?
  calenderEntity   CalenderEntity? @relation(fields: [calenderEntityId], references: [id], onDelete: Cascade)

  // Location Data
  complexId  String?
  complex    Complex?  @relation(fields: [complexId], references: [id])
  buildingId String?
  building   Building? @relation(fields: [buildingId], references: [id])
  floorId    String
  floor      Floor     @relation(fields: [floorId], references: [id], onDelete: Cascade)
  unitId     String?
  unit       Unit?     @relation(fields: [unitId], references: [id])

  // Maintenance Data
  condition   Condition   @default(GOOD)
  criticality Criticality @default(LOW)

  // Dimensions Data
  glazedArea     Float?
  cleanableArea  Float?
  coveredArea    Float?
  totalNetArea   Float?
  totalGrossArea Float?
  height         Int?
  heated         Boolean @default(false)
  totalVolume    Float?

  photos File[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([floorId, buildingId, code])
  @@map("rooms")
}

// Assets
// categories - devices, finishings, items, machineries
// subcategories - devices: burglar devices, electrical devices, climate control devices etc.
// asset - door, window, siren, etc.
model AssetCategory {
  id          String            @id @default(uuid())
  name        String            @unique
  type        AssetCategoryType @default(DEVICES)
  description String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  assets      Asset[]

  @@index([type])
  @@index([name])
  @@map("asset_categories")
}

model Asset {
  id          String        @id @default(uuid())
  name        String
  description String?
  categoryId  String
  category    AssetCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  @@index([name])
  @@map("assets")
}

model File {
  id  String @id @default(uuid())
  url String @unique

  rooms     Room[]
  units     Unit[]
  buildings Building[]
  complexes Complex[]

  @@map("files")
}

model CalenderEntity {
  id   String @id @default(uuid())
  name String

  buildings Building[]
  complexes Complex[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  units     Unit[]
  rooms     Room[]

  @@map("calender_entities")
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@map("refresh_tokens")
}
